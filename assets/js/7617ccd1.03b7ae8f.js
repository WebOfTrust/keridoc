"use strict";(self.webpackChunkkeridoc=self.webpackChunkkeridoc||[]).push([[2691],{1589:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>h,contentTitle:()=>o,default:()=>l,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var n=i(4848),t=i(8453);const r={Status:null},o="Create a search index",a={id:"how-we-did/kerisse/create-search-index",title:"Create a search index",description:"Instructions plus background.",source:"@site/docs/how-we-did/06_kerisse/create-search-index.md",sourceDirName:"how-we-did/06_kerisse",slug:"/how-we-did/kerisse/create-search-index",permalink:"/keridoc/docs/how-we-did/kerisse/create-search-index",draft:!1,unlisted:!1,editUrl:"https://github.com/WebOfTrust/keridoc/tree/main/docs/how-we-did/06_kerisse/create-search-index.md",tags:[],version:"current",frontMatter:{Status:null},sidebar:"tutorialSidebar",previous:{title:"Kerific Discord bot",permalink:"/keridoc/docs/how-we-did/kerific/kerific-discord-bot"},next:{title:"IP rights of scraped sources",permalink:"/keridoc/docs/how-we-did/kerisse/ip-rights-scraping"}},h={},d=[{value:"Instructions: how to add a website to the search index",id:"instructions-how-to-add-a-website-to-the-search-index",level:2},{value:"Sitemap",id:"sitemap",level:3},{value:"Scraper",id:"scraper",level:3},{value:"Import",id:"import",level:3},{value:"Additional config options",id:"additional-config-options",level:3},{value:"Background info",id:"background-info",level:2},{value:"Three steps",id:"three-steps",level:3},{value:"1: Decide which webpages (URLs) we want in our search index",id:"1-decide-which-webpages-urls-we-want-in-our-search-index",level:4},{value:"2: Retrieve the content of the URLs (scraping)",id:"2-retrieve-the-content-of-the-urls-scraping",level:4},{value:"3: Import the content into the Typesense search index",id:"3-import-the-content-into-the-typesense-search-index",level:4},{value:"More detailed steps",id:"more-detailed-steps",level:3},{value:"Software used",id:"software-used",level:3},{value:"Visualisation",id:"visualisation",level:3}];function c(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"create-a-search-index",children:"Create a search index"})}),"\n",(0,n.jsx)(s.p,{children:"Instructions plus background."}),"\n",(0,n.jsx)(s.h2,{id:"instructions-how-to-add-a-website-to-the-search-index",children:"Instructions: how to add a website to the search index"}),"\n",(0,n.jsx)(s.p,{children:"To add a website to the search index there are three parts to consider:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"Obtaining a sitemap.xml"}),"\n",(0,n.jsx)(s.li,{children:"Scraping all the URLs in the sitemap"}),"\n",(0,n.jsx)(s.li,{children:"Importing the content into the search index"}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Everything is done via the terminal (command line)."}),"\n",(0,n.jsx)(s.h3,{id:"sitemap",children:"Sitemap"}),"\n",(0,n.jsx)(s.p,{children:"Find out if the website has a sitemap.xml."}),"\n",(0,n.jsxs)(s.p,{children:["If the website is ",(0,n.jsx)(s.code,{children:"https://the-website.com"})," then try ",(0,n.jsx)(s.code,{children:"https://the-website.com/sitemap.xml"}),", if that gives a list with URLs then that is your sitemap. Write it down so you can use it in a moment."]}),"\n",(0,n.jsx)(s.p,{children:"If it does not exist, or you think it is not up to date then make a sitemap via de Kerisse sitemap creator:"}),"\n",(0,n.jsxs)(s.p,{children:["Open ",(0,n.jsx)(s.code,{children:"search-index-typesense/config/config_sitemaps_create.sh"})," and follow the instructions."]}),"\n",(0,n.jsxs)(s.p,{children:["There are two sections ",(0,n.jsx)(s.em,{children:"General websites"})," and ",(0,n.jsx)(s.em,{children:"Github repos"}),". Use ",(0,n.jsx)(s.em,{children:"sitemap-generator"})," for a website in general and use the specialized ",(0,n.jsx)(s.em,{children:"createSitemapGithub.mjs"})," for Github repo's."]}),"\n",(0,n.jsx)(s.h3,{id:"scraper",children:"Scraper"}),"\n",(0,n.jsx)(s.p,{children:"Now that we have the URLs that we want to scrape, we have to configure the scraper."}),"\n",(0,n.jsxs)(s.p,{children:["Open ",(0,n.jsx)(s.code,{children:"search-index-typesense/config/configScraperGenericSitemaps.mjs"}),"."]}),"\n",(0,n.jsx)(s.admonition,{type:"note",children:(0,n.jsx)(s.p,{children:"For every website there is a config object and a function. Every function has to be exported. This is not very user-friendly, and will change in the future."})}),"\n",(0,n.jsx)(s.p,{children:"Now go to the main menu:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"sh search-index-typesense/main.sh\n"})}),"\n",(0,n.jsx)(s.p,{children:"Choose option [1] Scrape all sites"}),"\n",(0,n.jsx)(s.p,{children:"It can take a long time before the scraper finishes. The terminal will output what is happening."}),"\n",(0,n.jsx)(s.h3,{id:"import",children:"Import"}),"\n",(0,n.jsx)(s.p,{children:"After the scrape session has finished, go to the main menu again:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"sh search-index-typesense/main.sh\n"})}),"\n",(0,n.jsx)(s.p,{children:"and choose option [3] Import"}),"\n",(0,n.jsx)(s.p,{children:"Now the new content will be imported into the Typesense system (in the cloud)."}),"\n",(0,n.jsx)(s.h3,{id:"additional-config-options",children:"Additional config options"}),"\n",(0,n.jsxs)(s.p,{children:["Go to the config section: ",(0,n.jsx)(s.code,{children:"search-index-typesense/config/"})]}),"\n",(0,n.jsxs)(s.p,{children:["For manual entries in the search index, see ",(0,n.jsx)(s.a,{href:"https://github.com/WebOfTrust/keridoc/blob/main/search-index-typesense/config/config-search-index-entries-manual/README.md",children:"this Readme"})]}),"\n",(0,n.jsxs)(s.p,{children:["For manual created sitemaps, see ",(0,n.jsx)(s.a,{href:"https://github.com/WebOfTrust/keridoc/blob/main/search-index-typesense/config/config-sitemaps-exlude-urls/README.md",children:"this Readme"})]}),"\n",(0,n.jsxs)(s.p,{children:["For manual created sitemaps, see ",(0,n.jsx)(s.a,{href:"https://github.com/WebOfTrust/keridoc/blob/main/search-index-typesense/config/config-sitemaps-manual/README.md",children:"this Readme"})]}),"\n",(0,n.jsx)(s.p,{children:"It is possible to override search index entries and give them prio in the search results."}),"\n",(0,n.jsx)(s.p,{children:"Example:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:'[\n    {\n        "name": "Diger",\n        "query": "Diger",\n        "url": "https://github.com/WebOfTrust/keripy/blob/main/src/keri/core/coring.py",\n        "position": 1,\n        "match": "exact"\n    }\n]\n'})}),"\n",(0,n.jsx)(s.h2,{id:"background-info",children:"Background info"}),"\n",(0,n.jsxs)(s.p,{children:["For who is this ",(0,n.jsx)(s.em,{children:"how-we-did"}),": Maintainers of the KERISSE site"]}),"\n",(0,n.jsx)(s.p,{children:"Why should you stick to this step by step: | @kordwarshuis ?? |"}),"\n",(0,n.jsx)(s.h3,{id:"three-steps",children:"Three steps"}),"\n",(0,n.jsx)(s.p,{children:"The creation of a search index for a website involves three steps:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"Decide which webpages (URLs) we want in our search index"}),"\n",(0,n.jsx)(s.li,{children:"Retrieve the content of the URLs (scraping)"}),"\n",(0,n.jsx)(s.li,{children:"Import the content into the Typesense search index"}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"1-decide-which-webpages-urls-we-want-in-our-search-index",children:"1: Decide which webpages (URLs) we want in our search index"}),"\n",(0,n.jsx)(s.p,{children:"You cannot be sent out to fetch something if they don't tell you where to go. That is what a sitemap is for."}),"\n",(0,n.jsxs)(s.p,{children:["We have to create lists that contain all URLs that should be visited and scraped. These lists are called ",(0,n.jsx)(s.em,{children:"sitemaps"}),"."]}),"\n",(0,n.jsx)(s.p,{children:"A sitemap is a list of URLs. The most common format is XML."}),"\n",(0,n.jsx)(s.p,{children:"There are three kinds of sitemaps we have to deal with:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["The sitemap.xml can be ",(0,n.jsx)(s.strong,{children:"remote"}),", that means, it is located at the domain that you will scrape, usually in the root, named \u201csitemap.xml\u201d. It is also a source for search engines like Google and Bing.\nIf this is not present, we have to look further:"]}),"\n",(0,n.jsxs)(s.li,{children:["The remote sitemap can also be in the form of an ",(0,n.jsx)(s.strong,{children:"HTML sitemap"}),". This sitemap is meant for human visitors but can also be read by scrapers.\nIf this also does not exist, we have to create something ourselves:"]}),"\n",(0,n.jsxs)(s.li,{children:["The sitemap can be a local sitemap. Meaning: this sitemap is ",(0,n.jsx)(s.strong,{children:"created by you"}),", using a sitemap builder or manually."]}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"2-retrieve-the-content-of-the-urls-scraping",children:"2: Retrieve the content of the URLs (scraping)"}),"\n",(0,n.jsx)(s.p,{children:"The scraper uses the sitemaps as input and goes through all the URLs and indexes all paragraphs, lists, tables, code fragments, and saves it in JSONL (a special form of JSON) format."}),"\n",(0,n.jsx)(s.h4,{id:"3-import-the-content-into-the-typesense-search-index",children:"3: Import the content into the Typesense search index"}),"\n",(0,n.jsxs)(s.p,{children:["When all the URLs of a website (or multiple websites) have been scraped and captured in JSON, this JSON is imported into the search engine. The search engine we use is called ",(0,n.jsx)(s.strong,{children:"Typesense"}),", and the data is imported into their cloud solution."]}),"\n",(0,n.jsxs)(s.p,{children:["In ",(0,n.jsx)(s.strong,{children:"Typesense"})," a \u201cdocument\u201d is what a \u201crecord\u201d is in a database."]}),"\n",(0,n.jsxs)(s.p,{children:["The documents we want to import have to follow a schema (",(0,n.jsx)(s.a,{href:"https://typesense.org/docs/26.0/api/collections.html#with-pre-defined-schema",children:"Example schema on the Typesense website"}),"). We created our own schema for Kerisse."]}),"\n",(0,n.jsxs)(s.p,{children:["More info on the ",(0,n.jsx)(s.a,{href:"https://typesense.org/docs/",children:"Typesense website"}),"."]}),"\n",(0,n.jsx)(s.h3,{id:"more-detailed-steps",children:"More detailed steps"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Test If Required Libraries Are Installed"}),"\n",(0,n.jsxs)(s.li,{children:["Initializing","\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Get the directory where the main.sh script is located"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["Preparing","\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Prepare file system. Remove old files and directories and create new ones."}),"\n",(0,n.jsx)(s.li,{children:"Copy handmade stuff: entries for direct import into Typesense, manual files, sitemaps."}),"\n",(0,n.jsx)(s.li,{children:"Create sitemaps via sitemap-generator."}),"\n",(0,n.jsx)(s.li,{children:"Remove unwanted urls from the sitemaps (new sitemaps generated or not)"}),"\n",(0,n.jsx)(s.li,{children:"Filenames to lowercase."}),"\n",(0,n.jsx)(s.li,{children:"Fetch external content from Google Sheets."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["Start Scraping","\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Scrape the websites."}),"\n",(0,n.jsx)(s.li,{children:"Split the content.jsonl file into multiple files so the size is optimal for Typesense."}),"\n",(0,n.jsx)(s.li,{children:"Count the total number of lines in all .jsonl files and write it to log dir."}),"\n",(0,n.jsx)(s.li,{children:"Sort and style the index file."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["Backing Up","\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Backup output (scrape results, handmade stuff, sitemaps, logs, webpage overview, typesense export)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"software-used",children:"Software used"}),"\n",(0,n.jsx)(s.p,{children:"The following tools are used for scraping:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Cheerio"}),"\n",(0,n.jsx)(s.li,{children:"Puppeteer"}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["\u201c",(0,n.jsx)(s.a,{href:"https://cheerio.js.org/",children:"Cheerio can parse nearly any HTML or XML document. Cheerio works in both browser and server environments."}),"\u201d"]}),"\n",(0,n.jsxs)(s.p,{children:["\u201c",(0,n.jsx)(s.a,{href:"https://pptr.dev/",children:'Puppeteer is a Node.js library which provides a high-level API to control Chrome or Firefox over the DevTools Protocol or WebDriver BiDi. Puppeteer runs in the headless (no visible UI) by default but can be configured to run in a visible ("headful") browser.'}),"\u201d"]}),"\n",(0,n.jsx)(s.h3,{id:"visualisation",children:"Visualisation"}),"\n",(0,n.jsx)("img",{src:i(7974).A,alt:""})]})}function l(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},7974:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/scraping-1d8a5c98ffb43b69eb989d27171b175a.png"},8453:(e,s,i)=>{i.d(s,{R:()=>o,x:()=>a});var n=i(6540);const t={},r=n.createContext(t);function o(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);